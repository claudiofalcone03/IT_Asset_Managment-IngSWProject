<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Carica la libreria dayjs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.7/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

    
    <style>
     body {
        font-family: 'Montserrat', Tahoma, Geneva, Verdana, sans-serif;
        margin: 20px;
        background-color: #f1f1f1;
        color: #333;
        line-height: 1.6;
    }
        /* Stile per la tabella */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            margin-bottom: 30px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* Aggiungi ombra alla tabella */
        }
    
        table th, table td {
            padding: 15px;
            text-align: left;
            font-size: 16px;
            transition: background-color 0.3s ease; /* Aggiungi effetto transizione */
        }
    
        table th {
            background-color: #8a2be2; /* Viola più intenso */
            color: white;
            font-weight: 600;
        }
    
        table tbody tr:nth-child(even) {
            background-color: #f7f7f7; /* Colore alternato più delicato */
        }
    
        table tbody tr:hover {
            background-color: #d6a8e0; /* Hover viola chiaro */
            transform: translateY(-2px); /* Effetto di sollevamento al passaggio del mouse */
        }
    
        /* Contenitore per i filtri */
        .filters {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* Ombra leggera */
        }
    
        .filters label {
            margin-right: 15px;
            font-weight: bold;
            color: #555;
        }
    
        .filters select, .filters input[type="text"] {
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
            transition: border-color 0.3s ease;
        }
    
        .filters select:focus, .filters input[type="text"]:focus {
            border-color: #8a2be2; /* Colore di focus */
            outline: none;
        }
    
        .filters button {
            background-color: #8a2be2;
            color: white;
            padding: 8px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Ombra leggera sul pulsante */
        }
    
        .filters button:hover {
            background-color: #6a0dad; /* Colore più scuro al passaggio del mouse */
            transform: translateY(-2px); /* Effetto di sollevamento */
        }
    
        /* Stile per i messaggi */
        .message {
            font-size: 18px;
            color: #555;
            padding: 10px;
            border-radius: 5px;
            margin-top: 20px;
            background-color: #e0f7fa;
            border: 1px solid #b2ebf2;
        }
    
        /* Stile per le icone */
        .icon {
            margin-right: 10px;
        }
    </style>
    <style>

  
        .container {
                    display: flex;
                    justify-content: space-between;
                    gap: 20px;
                    margin-top: 30px;
                }
        
                .chart-container {
                    width: 48%;  /* Impostiamo una larghezza di 48% per ogni grafico */
                    height: 400px;
                    
                    
                   
                    padding: 20px;
                }
        </style>  

<body>

    <!-- Filtri per status e sede -->
    <div class="filters">
        <label for="statusFilter">Status:</label>
        <select id="statusFilter">
            <option value="">Tutti</option>
            <option value="attivi">Attivi</option>
            <option value="inattivi">Inattivi</option>
            <option value="in Attesa">In attesa</option>
            <option value="Richiedibili">Richiedibili</option>
            <option value="Archiviati">Archiviati</option>
        </select>

        <label for="sedeFilter">Sede:</label>
        <select id="sedeFilter">
            <option value="">Tutte</option>
            <option value="sede centrale">Centrale</option>
            <option value="sede Principale">Principale</option>
            <option value="sede Secondaria">Secondaria</option>
            <option value="sede Filiale">Filiale</option>
        </select>

        <label for="priceSort">Prezzo:</label>
        <select id="priceSort">
            <option value="">Nessun ordinamento</option>
            <option value="asc">Crescente</option>
            <option value="desc">Decrescente</option>
        </select>


        <button onclick="applyFilters()">Filtra</button>



    </div>


    
    <!-- Tabella -->
    <table id="assetTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Status</th>
                <th>Data Inserimento</th>
                <th>Sede</th>
                <th>Data Acquisto</th>
                <th>Costo</th>
            </tr>
        </thead>
        <tbody>
            <!-- Le righe saranno aggiunte dinamicamente -->
        </tbody>
    </table>

    <script>
        // Funzione per formattare le date
        function formatDate(date) {
            return dayjs(date).format('YYYY/MM/DD');
        }

        // Funzione per caricare i dati dal backend con filtri
        async function loadAssets(filters = {}) {
            try {
                let url = 'http://localhost:3000/api/assets';
                const params = new URLSearchParams(filters).toString();
                if (params) url += `?${params}`;
                console.log("Fetching URL:", url);  // Aggiungi un log per vedere la URL
                
                const response = await fetch(url);
                const data = await response.json();
                if (filters.priceSort) {
                    data.sort((a, b) => {
                        const priceA = parseFloat(a.costo);
                        const priceB = parseFloat(b.costo);

                        if (filters.priceSort === 'asc') {
                            return priceA - priceB; // Crescente
                        } else {
                            return priceB - priceA; // Decrescente
                        }
                    });
                }

                const tableBody = document.querySelector("#assetTable tbody");
                tableBody.innerHTML = ""; // Reset della tabella

                data.forEach(asset => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${asset.id}</td>
                        <td>${asset.name}</td>
                        <td>${asset.status}</td>
                        <td>${formatDate(asset.data_inserimento)}</td>
                        <td>${asset.sede}</td>
                        <td>${formatDate(asset.data_acquisto)}</td>
                        <td>€${parseFloat(asset.costo).toFixed(2)}</td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Errore durante il caricamento degli asset:', error);
            }
        }

        // Applica i filtri dalla UI
        function applyFilters() {
            const status = document.getElementById('statusFilter').value;
            const sede = document.getElementById('sedeFilter').value;
            const priceSort = document.getElementById('priceSort').value;

            const filters = {};
            if (status) filters.status = status;
            if (sede) filters.sede = sede;
            if (priceSort) filters.priceSort = priceSort;

            loadAssets(filters); // Ricarica la tabella con i filtri
        }

        // Carica gli asset all'avvio
        loadAssets();
    </script>


<div class="container">
    <div class="chart-container">
    <canvas id="assetChart" width="300" height="150"></canvas>
  </div>
  <div class="chart-container">
    <canvas id="costChart"></canvas>
</div>

  
<style>

  
.container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 30px;
        }

        .chart-container {
            width: 48%;  /* Impostiamo una larghezza di 48% per ogni grafico */
            height: 400px;
            
            
           
            padding: 20px;
        }
</style>  

<script>
    // Funzione per ottenere il numero di asset per sede
    async function loadAssetCountBySede() {
        try {
            const response = await fetch('http://localhost:3000/api/assets/count-by-sede');
            const data = await response.json();
            
            // Dati per il grafico
            const labels = [];
            const assetCounts = [];

            // Estrai le informazioni per il grafico
            data.forEach(item => {
                labels.push(item.sede);
                assetCounts.push(item.asset_count);
            });

            // Configura il grafico con i dati ottenuti
            const ctx = document.getElementById('assetChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar', // Tipo di grafico: barra
                data: {
                    labels: labels, // Etichette delle sedi
                    datasets: [{
                        label: 'Numero di Asset',
                        data: assetCounts, // Numero di asset per sede
                        backgroundColor: [
                'rgba(128, 0, 255, 0.6)',  // Viola brillante
                'rgba(75, 0, 130, 0.8)',    // Viola scuro intenso (Indigo)
                'rgba(153, 50, 204, 0.7)',  // Viola medio profondo (DarkOrchid)
                'rgba(186, 85, 211, 0.6)'   // Viola intenso (MediumOrchid)
                // Puoi aggiungere altre sfumature di viola brillante
            ],
            borderColor: [
                'rgba(128, 0, 255, 1)',  // Viola brillante bordo
                'rgba(75, 0, 130, 1)',    // Viola scuro intenso bordo (Indigo)
                'rgba(153, 50, 204, 1)',  // Viola medio profondo bordo (DarkOrchid)
                'rgba(186, 85, 211, 1)'   // Viola intenso bordo (MediumOrchid)
                // Puoi aggiungere altri bordi viola brillante
            ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        } catch (error) {
            console.error('Errore durante il caricamento dei dati:', error);
        }
    }

    // Carica i dati quando la pagina viene caricata
    loadAssetCountBySede();
</script>


<body>
    
    
    <script>
        // Funzione per recuperare i dati dal backend Node.js
        fetch('http://localhost:3000/costi')  // Chiamata al server Node.js
            .then(response => response.json())
            .then(data => {
                // Prepara le etichette e i costi per il grafico
                const labels = data.map(item => `${item.mese}/${item.anno}`);
                const costs = data.map(item => item.totale_costo);

                // Crea il grafico
                const ctx = document.getElementById('costChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Totale Costi',
                            data: costs,
                            borderColor: '#8a2be2', // Colore viola
                            backgroundColor: 'rgba(138, 43, 226, 0.2)', // Colore trasparente
                            borderWidth: 2,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Totale Costi degli Asset per Mese'
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true
                            },
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            })
            .catch(error => console.error('Errore nel recupero dei dati:', error));
    </script>

</body>
</body>
</html>
